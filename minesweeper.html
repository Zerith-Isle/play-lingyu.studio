<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰«é›·æ¸¸æˆ/é›¶å±¿å·¥ä½œå®¤</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <style>
        .cell {
            width: 25px;
            height: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ccc;
            background-color: #e0e0e0;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }

        .cell.clicked {
            background-color: #bdbdbd;
        }

        .cell.mine {
            background-color: red;
        }

        .cell.flagged {
            color: red;
        }

        /* æ•°å­—é¢œè‰² */
        .cell[data-value="1"] {
            color: blue;
        }

        .cell[data-value="2"] {
            color: green;
        }

        .cell[data-value="3"] {
            color: red;
        }

        .cell[data-value="4"] {
            color: darkviolet;
        }

        .cell[data-value="5"] {
            color: maroon;
        }

        .cell[data-value="6"] {
            color: teal;
        }

        .cell[data-value="7"] {
            color: black;
        }

        .cell[data-value="8"] {
            color: gray;
        }

        .game-board {
            display: grid;
            gap: 0;
            background-color: #bdbdbd;
            padding: 5px;
            border-radius: 5px;
            margin: 20px auto;
            justify-content: center;
        }

        /* æˆç»©æ¦œå±•å¼€æ ·å¼ */
        #scoreboard.collapsed .scoreboard-content {
            display: none;
        }

        #scoreboard .toggle-btn {
            cursor: pointer;
        }

        .result-win {
            color: green;
        }

        .result-lose {
            color: red;
        }
    </style>
</head>

<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4">
        <div class="flex justify-between items-center mb-4">
            <a href="index.html" class="text-xl text-blue-500 hover:text-blue-600">
                <i class="fa-solid fa-arrow-left"></i>
            </a>
            <h1 class="text-3xl font-bold text-center">æ‰«é›·æ¸¸æˆ</h1>
            <div></div>
        </div>
        <div class="flex justify-between items-center mb-4">
            <div class="text-lg font-bold">
                <span id="score">åˆ†æ•°: 0</span>
                <span id="mine-count"> åœ°é›·ä¸ªæ•°: 0</span>
            </div>
            <div class="text-lg font-bold" id="timer">æ—¶é—´: 0s</div>
        </div>
        <div class="flex justify-center mb-4">
            <button id="reset-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
                é‡ç½®
            </button>
        </div>
        <div class="flex justify-center mb-4">
            <select id="difficulty-select" class="border border-gray-300 p-2 rounded">
                <option value="10x10">åŸºç¡€ (10x10)</option>
                <option value="16x16">ä¸­çº§ (16x16)</option>
                <option value="16x30">ä¸“å®¶ (16x30)</option>
                <option value="fullscreen">æ»¡å±</option>
                <option value="custom">è‡ªå®šä¹‰</option>
            </select>
            <input type="number" id="custom-width" placeholder="å®½åº¦" class="border border-gray-300 p-2 rounded ml-2"
                style="display: none;">
            <input type="number" id="custom-height" placeholder="é«˜åº¦" class="border border-gray-300 p-2 rounded ml-2"
                style="display: none;">
        </div>
        <div id="game-board" class="game-board"></div>
        <div id="scoreboard" class="border border-gray-300 p-4 rounded mt-4">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-bold">æˆç»©æ¦œ</h2>
                <span class="toggle-btn" onclick="toggleScoreboard()"><i class="fa-solid fa-chevron-down"></i></span>
            </div>
            <div class="scoreboard-content">
                <table class="w-full">
                    <thead>
                        <tr>
                            <th class="text-left">éš¾åº¦</th>
                            <th class="text-left">æ¸¸æˆæ—¶é—´</th>
                            <th class="text-left">æ¸¸æˆç»“æœ</th>
                            <th class="text-left">æ¸¸ç©æ—¥æœŸ</th>
                        </tr>
                    </thead>
                    <tbody id="scoreboard-body"></tbody>
                </table>
            </div>
        </div>
        <div class="mt-4">
            <h2 class="text-xl font-bold">ç©æ³•ä»‹ç»</h2>
            <p>æ¸¸æˆç›®æ ‡ï¼šç¿»å¼€æ‰€æœ‰æ²¡æœ‰åœ°é›·çš„æ ¼å­ï¼ŒåŒæ—¶é¿å…ç‚¹å‡»åˆ°åœ°é›·ã€‚</p>
            <p>åŸºæœ¬è§„åˆ™ï¼š</p>
            <ul>
                <li>æ¯ä¸ªæ ¼å­ç¿»å¼€åå¯èƒ½æ˜¾ç¤ºæ•°å­—æˆ–è€…åœ°é›·ã€‚æ•°å­—è¡¨ç¤ºè¯¥æ ¼å­å‘¨å›´ 8 ä¸ªæ ¼å­ä¸­åœ°é›·çš„æ•°é‡ã€‚</li>
                <li>å¦‚æœç¿»å¼€çš„æ ¼å­æ˜¯åœ°é›·ï¼Œæ¸¸æˆå¤±è´¥ã€‚</li>
                <li>å½“æ‰€æœ‰æ²¡æœ‰åœ°é›·çš„æ ¼å­éƒ½è¢«ç¿»å¼€æ—¶ï¼Œæ¸¸æˆèƒœåˆ©ã€‚</li>
            </ul>
            <p>æ“ä½œæ–¹æ³•ï¼š</p>
            <ul>
                <li>ç”µè„‘ç«¯ï¼šå·¦é”®ç‚¹å‡»ç¿»å¼€æ ¼å­ï¼Œå³é”®ç‚¹å‡»æ ‡è®°é›·ã€‚</li>
                <li>æ‰‹æœºç«¯ï¼šå•å‡»ç¿»æ ¼å­ï¼Œé•¿æŒ‰ 3s æ ‡é›·ã€‚</li>
            </ul>
            <p>ç­–ç•¥æç¤ºï¼š</p>
            <ul>
                <li>å¦‚æœä¸€ä¸ªæ ¼å­æ˜¾ç¤ºæ•°å­— 1ï¼Œè¯´æ˜å®ƒå‘¨å›´ 8 ä¸ªæ ¼å­ä¸­æœ‰ 1 ä¸ªåœ°é›·ã€‚</li>
                <li>æ ¹æ®æ•°å­—çš„æç¤ºï¼Œé€æ­¥æ¨ç†å‡ºåœ°é›·çš„ä½ç½®ã€‚</li>
                <li>å¯ä»¥å…ˆä»è¾¹ç¼˜æˆ–è€…æ•°å­—è¾ƒå°çš„åŒºåŸŸå¼€å§‹å°è¯•ã€‚</li>
            </ul>
        </div>
    </div>
    <audio id="click-sound" src="https://www.soundjay.com/button/beep-07.wav"></audio>
    <audio id="win-sound" src="https://www.soundjay.com/button/beep-06.wav"></audio>
    <audio id="lose-sound" src="https://www.soundjay.com/button/beep-05.wav"></audio>
    <script>
        const gameBoard = document.getElementById('game-board');
        const scoreElement = document.getElementById('score');
        const mineCountElement = document.getElementById('mine-count');
        const timerElement = document.getElementById('timer');
        const resetButton = document.getElementById('reset-button');
        const difficultySelect = document.getElementById('difficulty-select');
        const customWidthInput = document.getElementById('custom-width');
        const customHeightInput = document.getElementById('custom-height');
        const scoreboardBody = document.getElementById('scoreboard-body');
        const clickSound = document.getElementById('click-sound');
        const winSound = document.getElementById('win-sound');
        const loseSound = document.getElementById('lose-sound');

        let board;
        let width;
        let height;
        let mines;
        let revealedCells = 0;
        let flaggedCells = 0;
        let isGameOver = false;
        let timer;
        let startTime;
        let scores = [];

        function createBoard() {
            gameBoard.innerHTML = '';
            gameBoard.style.gridTemplateColumns = `repeat(${width}, 25px)`;
            board = Array.from({ length: height }, () => Array(width).fill(0));
            revealedCells = 0;
            flaggedCells = 0;
            isGameOver = false;
            scoreElement.textContent = `åˆ†æ•°: 0`;
            mineCountElement.textContent = ` åœ°é›·ä¸ªæ•°: ${mines}`;
            clearInterval(timer);
            timerElement.textContent = `æ—¶é—´: 0s`;

            // æ”¾ç½®åœ°é›·
            let minesPlaced = 0;
            while (minesPlaced < mines) {
                const x = Math.floor(Math.random() * width);
                const y = Math.floor(Math.random() * height);
                if (board[y][x] !== -1) {
                    board[y][x] = -1;
                    minesPlaced++;
                }
            }

            // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°é‡
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    if (board[y][x] !== -1) {
                        let count = 0;
                        for (let dy = -1; dy <= 1; dy++) {
                            for (let dx = -1; dx <= 1; dx++) {
                                if (dy === 0 && dx === 0) continue;
                                const ny = y + dy;
                                const nx = x + dx;
                                if (ny >= 0 && ny < height && nx >= 0 && nx < width && board[ny][nx] === -1) {
                                    count++;
                                }
                            }
                        }
                        board[y][x] = count;
                    }
                }
            }

            // åˆ›å»ºæ ¼å­å…ƒç´ 
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    cell.addEventListener('click', () => {
                        clickSound.play();
                        handleClick(x, y, false);
                    });
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        clickSound.play();
                        handleClick(x, y, true);
                    });
                    let longPressTimer;
                    const longPressDuration = 3000;
                    cell.addEventListener('touchstart', () => {
                        longPressTimer = setTimeout(() => {
                            clickSound.play();
                            handleClick(x, y, true);
                        }, longPressDuration);
                    });
                    cell.addEventListener('touchend', (e) => {
                        clearTimeout(longPressTimer);
                        if (e.timeStamp - e.target.dataset.touchStartTime < longPressDuration) {
                            clickSound.play();
                            handleClick(x, y, false);
                        }
                    });
                    cell.addEventListener('touchstart', (e) => {
                        e.target.dataset.touchStartTime = e.timeStamp;
                    });
                    gameBoard.appendChild(cell);
                }
            }
        }

        function handleClick(x, y, isRightClick) {
            if (isGameOver) return;
            if (!startTime) {
                startTime = Date.now();
                timer = setInterval(() => {
                    const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                    timerElement.textContent = `æ—¶é—´: ${elapsedTime}s`;
                }, 1000);
            }
            const cell = document.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`);
            if (isRightClick) {
                if (!cell.classList.contains('clicked')) {
                    if (cell.classList.contains('flagged')) {
                        cell.classList.remove('flagged');
                        cell.textContent = '';
                        flaggedCells--;
                    } else {
                        cell.classList.add('flagged');
                        cell.textContent = 'ğŸš©';
                        flaggedCells++;
                    }
                }
            } else {
                if (cell.classList.contains('flagged')) return;
                if (board[y][x] === -1) {
                    // ç‚¹å‡»åˆ°åœ°é›·ï¼Œæ¸¸æˆç»“æŸ
                    gameOver(false);
                } else {
                    revealCell(x, y);
                    if (revealedCells === width * height - mines) {
                        // æ‰€æœ‰éåœ°é›·æ ¼å­éƒ½å·²ç¿»å¼€ï¼Œæ¸¸æˆèƒœåˆ©
                        gameOver(true);
                    }
                }
            }
        }

        function revealCell(x, y) {
            const cell = document.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`);
            if (cell.classList.contains('clicked')) return;
            if (cell.classList.contains('flagged')) {
                cell.classList.remove('flagged');
                cell.textContent = '';
                flaggedCells--;
            }
            cell.classList.add('clicked');
            revealedCells++;
            if (board[y][x] > 0) {
                cell.textContent = board[y][x];
                cell.dataset.value = board[y][x];
            } else if (board[y][x] === 0) {
                for (let dy = -1; dy <= 1; dy++) {
                    for (let dx = -1; dx <= 1; dx++) {
                        if (dy === 0 && dx === 0) continue;
                        const ny = y + dy;
                        const nx = x + dx;
                        if (ny >= 0 && ny < height && nx >= 0 && nx < width) {
                            revealCell(nx, ny);
                        }
                    }
                }
            }
        }

        function gameOver(isWin) {
            isGameOver = true;
            clearInterval(timer);
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            if (isWin) {
                scoreElement.textContent = `åˆ†æ•°: ${elapsedTime}`;
                winSound.play();
            } else {
                loseSound.play();
            }
            // è®°å½•æˆç»©
            const difficulty = getDifficultyText();
            const result = isWin? 'èƒœåˆ©' : 'å¤±è´¥';
            const date = new Date().toLocaleDateString();
            scores.push({ difficulty, time: elapsedTime, result, date });
            scores.sort((a, b) => a.time - b.time);
            updateScoreboard();

            // æ˜¾ç¤ºæ‰€æœ‰åœ°é›·å’Œæ•°å­—
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const cell = document.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`);
                    if (board[y][x] === -1) {
                        cell.classList.add('mine');
                        cell.textContent = 'ğŸ’£';
                    } else if (board[y][x] > 0) {
                        cell.textContent = board[y][x];
                        cell.dataset.value = board[y][x];
                    }
                }
            }
        }

        function resetGame() {
            if (!isGameOver && startTime) {
                if (!confirm('ä½ ç¡®å®šè¦åœæ­¢å½“å‰æ¸¸æˆå¹¶é‡ç½®å—ï¼Ÿ')) {
                    return;
                }
            }
            startTime = null;
            createBoard();
        }

        function changeDifficulty() {
            if (!isGameOver && startTime) {
                if (!confirm('ä½ ç¡®å®šè¦åœæ­¢å½“å‰æ¸¸æˆå¹¶åˆ‡æ¢éš¾åº¦å—ï¼Ÿ')) {
                    return;
                }
            }
            const selectedValue = difficultySelect.value;
            if (selectedValue === 'custom') {
                customWidthInput.style.display = 'inline-block';
                customHeightInput.style.display = 'inline-block';
            } else {
                customWidthInput.style.display = 'none';
                customHeightInput.style.display = 'none';
                if (selectedValue === '10x10') {
                    width = 10;
                    height = 10;
                    mines = 10;
                } else if (selectedValue === '16x16') {
                    width = 16;
                    height = 16;
                    mines = 40;
                } else if (selectedValue === '16x30') {
                    width = 30;
                    height = 16;
                    mines = 99;
                } else if (selectedValue === 'fullscreen') {
                    const screenSize = Math.min(window.innerWidth, window.innerHeight);
                    const gridSize = Math.floor(screenSize / 25);
                    width = gridSize;
                    height = gridSize;
                    mines = Math.floor(gridSize * gridSize * 0.2);
                }
                startTime = null;
                createBoard();
            }
        }

        function applyCustomDifficulty() {
            const customWidth = parseInt(customWidthInput.value);
            const customHeight = parseInt(customHeightInput.value);
            if (customWidth >= 5 && customHeight >= 5) {
                width = customWidth;
                height = customHeight;
                mines = Math.floor(customWidth * customHeight * 0.2);
                startTime = null;
                createBoard();
            } else {
                alert('è‡ªå®šä¹‰éš¾åº¦çš„é•¿å’Œå®½ä¸èƒ½å°äº 5ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚');
            }
        }

        function updateScoreboard() {
            scoreboardBody.innerHTML = '';
            scores.forEach((score) => {
                const row = document.createElement('tr');
                const difficultyCell = document.createElement('td');
                difficultyCell.textContent = score.difficulty;
                const timeCell = document.createElement('td');
                timeCell.textContent = `${score.time}s`;
                const resultCell = document.createElement('td');
                resultCell.textContent = score.result;
                resultCell.classList.add(score.result === 'èƒœåˆ©'? 'result-win' : 'result-lose');
                const dateCell = document.createElement('td');
                dateCell.textContent = score.date;
                row.appendChild(difficultyCell);
                row.appendChild(timeCell);
                row.appendChild(resultCell);
                row.appendChild(dateCell);
                scoreboardBody.appendChild(row);
            });
        }

        function getDifficultyText() {
            const selectedValue = difficultySelect.value;
            if (selectedValue === 'custom') {
                return `${customWidthInput.value}x${customHeightInput.value}`;
            } else if (selectedValue === 'fullscreen') {
                return `æ»¡å± (${width}x${height})`;
            } else {
                return selectedValue;
            }
        }

        function toggleScoreboard() {
            const scoreboard = document.getElementById('scoreboard');
            scoreboard.classList.toggle('collapsed');
            const toggleBtn = scoreboard.querySelector('.toggle-btn');
            toggleBtn.innerHTML = scoreboard.classList.contains('collapsed')? '<i class="fa-solid fa-chevron-down"></i>' : '<i class="fa-solid fa-chevron-up"></i>';
        }

        resetButton.addEventListener('click', resetGame);
        difficultySelect.addEventListener('change', changeDifficulty);
        customWidthInput.addEventListener('change', applyCustomDifficulty);
        customHeightInput.addEventListener('change', applyCustomDifficulty);

        // åˆå§‹åŒ–æ¸¸æˆ
        width = 10;
        height = 10;
        mines = 10;
        createBoard();
    </script>
</body>

</html>    